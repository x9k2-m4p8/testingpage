<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script type="text/javascript"
      src="https://onsite.optimonk.com/script.js?account=250907"
      async></script>
</head>
<body>
    <p>hello</p>
<script defer>
(function() {
  // Beállítások
  var countdown = 5; // Hány másodperc a TELJES betöltés után

  function fireAllianzEvent() {
    window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({
      'event': 'optimonk-allianz-event'
    });

    var event = new CustomEvent("optimonk-allianz-event", { bubbles: true });

    // QuickScroll minta alapján a documentElement-re lőjük
    document.documentElement.dispatchEvent(event);
    
    console.warn("BUMM! OptiMonk trigger fired: optimonk-allianz-event");
  }

  function startTimer() {
    console.log("Az oldal TELJESEN betöltött (képek is). Visszaszámlálás indul: " + countdown);

    var timer = setInterval(function() {
      countdown--;
      
      if (countdown > 0) {
        console.log("Visszaszámlálás: " + countdown + "...");
      } else {
        clearInterval(timer);
        fireAllianzEvent();
      }
    }, 1000);
  }

  // --- ITT A VÁLTOZÁS ---
  // A 'complete' állapot jelenti azt, hogy minden (képek, css) kész.
  if (document.readyState === "complete") {
    // Ha már véletlenül betöltött (pl. cache-ből gyorsan), azonnal indítunk
    startTimer();
  } else {
    // Ha még tölt, megvárjuk a 'load' eseményt (nem a DOMContentLoaded-et)
    window.addEventListener("load", startTimer);
  }
})();
</script>
</body>
</html>
